import{a as S,e as f,F as t,J as k}from"./main-04baad83.js";import{G as r,C as O,M as m,T as $,$ as l,c,b as d}from"./DarkTheme-7d442e55.js";import{g as D}from"./generate_filename-2109a26f.js";const i={fileEntry:null,fileWriter:null};i.initialize=function(_){r.active_tab!="logging"&&(r.active_tab="logging");let n=[],p=0,A=0,g=[];if(O.connectionValid){const e=function(){m.send_message(S.MSP_MOTOR,!1,!1,a)},a=function(){l("#content").load("./tabs/logging.html",h)};m.send_message(S.MSP_RC,!1,!1,e)}function h(){c.localizePage(),l("a.log_file").click(P),l("a.logging").click(function(){if(r.connected_to)if(i.fileEntry!=null){const e=l(this).data("clicks");if(e)r.interval_kill_all(),console.log("Closing file: ",i.fileEntry.name),f.closeFile(i.fileWriter).catch(a=>{console.error("Error closing file: ",a)}),l(".speed").prop("disabled",!1),l(this).text(c.getMessage("loggingStart")),l(this).data("clicks",!e);else if(p=0,A=0,g=[],n=[],l(".properties input:checked").each(function(){n.push(l(this).prop("name"))}),n.length){let s=function(){g.length&&(u(g.join(`
`).concat(`
`)),p+=g.length,l(".samples").text(p),g=[])};const a=function(){A&&T();for(let o=0;o<n.length;o++,A++)m.send_message(S[n[o]])};console.log("Opening file: ",i.fileEntry.name),f.openFile(i.fileEntry).then(o=>{i.fileWriter=o,M(),r.interval_add("log_data_poll",a,parseInt(l("select.speed").val()),!0),r.interval_add("write_data",s,1e3),l(".speed").prop("disabled",!0),l(this).text(c.getMessage("loggingStop")),l(this).data("clicks",e!==!0)})}else d(c.getMessage("loggingErrorOneProperty"))}else d(c.getMessage("loggingErrorLogFile"));else d(c.getMessage("loggingErrorNotConnected"))}),r.content_ready(_)}function M(){let e="timestamp";for(let a=0;a<n.length;a++)switch(n[a]){case"MSP_RAW_IMU":e+=",gyroscopeX",e+=",gyroscopeY",e+=",gyroscopeZ",e+=",accelerometerX",e+=",accelerometerY",e+=",accelerometerZ",e+=",magnetometerX",e+=",magnetometerY",e+=",magnetometerZ";break;case"MSP_ATTITUDE":e+=",kinematicsX",e+=",kinematicsY",e+=",kinematicsZ";break;case"MSP_ALTITUDE":e+=",altitude";break;case"MSP_RAW_GPS":e+=",gpsFix",e+=",gpsNumSat",e+=",gpsLat",e+=",gpsLon",e+=",gpsAlt",e+=",gpsSpeed",e+=",gpsGroundCourse";break;case"MSP_ANALOG":e+=",voltage",e+=",amperage",e+=",mAhdrawn",e+=",rssi";break;case"MSP_RC":for(let s=0;s<t.RC.active_channels;s++)e+=`,RC${s}`;break;case"MSP_MOTOR":for(let s=0;s<t.MOTOR_DATA.length;s++)e+=`,Motor${s}`;break;case"MSP_DEBUG":for(let s=0;s<t.SENSOR_DATA.debug.length;s++)e+=`,Debug${s}`;break}e+=`
`,u(e)}function T(){let e=k();for(let a=0;a<n.length;a++)switch(n[a]){case"MSP_RAW_IMU":e+=`,${t.SENSOR_DATA.gyroscope}`,e+=`,${t.SENSOR_DATA.accelerometer}`,e+=`,${t.SENSOR_DATA.magnetometer}`;break;case"MSP_ATTITUDE":e+=`,${t.SENSOR_DATA.kinematics[0]}`,e+=`,${t.SENSOR_DATA.kinematics[1]}`,e+=`,${t.SENSOR_DATA.kinematics[2]}`;break;case"MSP_ALTITUDE":e+=`,${t.SENSOR_DATA.altitude}`;break;case"MSP_RAW_GPS":e+=`,${t.GPS_DATA.fix}`,e+=`,${t.GPS_DATA.numSat}`,e+=`,${t.GPS_DATA.lat/1e7}`,e+=`,${t.GPS_DATA.lon/1e7}`,e+=`,${t.GPS_DATA.alt}`,e+=`,${t.GPS_DATA.speed}`,e+=`,${t.GPS_DATA.ground_course}`;break;case"MSP_ANALOG":e+=`,${t.ANALOG.voltage}`,e+=`,${t.ANALOG.amperage}`,e+=`,${t.ANALOG.mAhdrawn}`,e+=`,${t.ANALOG.rssi}`;break;case"MSP_RC":for(let s=0;s<t.RC.active_channels;s++)e+=`,${t.RC.channels[s]}`;break;case"MSP_MOTOR":e+=`,${t.MOTOR_DATA}`;break;case"MSP_DEBUG":e+=`,${t.SENSOR_DATA.debug}`;break}g.push(e)}function P(){const e="log",a="csv",s=D(e,a);f.pickSaveFile(s,c.getMessage("fileSystemPickerFiles",{typeof:a.toUpperCase}),`.${a}`).then(o=>{i.fileEntry=o,console.log("Log file path: ",o.name),l("a.logging").removeClass("disabled")})}function u(e){f.writeChunck(i.fileWriter,new Blob([e],{type:"text/plain"})).catch(a=>{console.error("Error appending to file: ",a)})}};i.cleanup=function(_){_&&_()};$.logging=i;export{i as logging};
