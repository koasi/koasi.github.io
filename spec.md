
# Pomodoro Flow 應用程式規格書

這份文件詳細描述了 Pomodoro Flow 應用程式的功能、元件設計和技術規格。

## 1. 總覽

Pomodoro Flow 是一個結合了番茄鐘計時器和待辦事項列表的網頁應用程式，旨在幫助使用者提升專注力和生產力。使用者可以設定工作時間（Pomodoro）、短休息和長休息，並將計時器與特定的待辦事項關聯。

## 2. 核心功能

### 2.1. 番茄鐘計時器 (Pomodoro Timer)

- **三種模式**：
  - **Pomodoro**：專注工作時間，預設為 25 分鐘。
  - **Short Break**：短休息時間，預設為 5 分鐘。
  - **Long Break**：長休息時間，在每完成 4 個番茄鐘後進行，預設為 15 分鐘。

- **主計時器顯示**：
  - 位於畫面左側，以大型數字時鐘和環形進度條顯示剩餘時間。
  - 環形進度條會隨著時間流逝而縮減。

- **計時器控制**：
  - **Start/Pause**：開始或暫停當前的計時器。
  - **Reset**：重置當前模式的計時器。
  - **模式切換**：使用者可以手動點擊上方的標籤頁（Pomodoro, Short Break, Long Break）來切換模式。切換模式會暫停當前的計時器。

- **自動循環**：
  - 當一個番茄鐘倒數結束時，會自動增加「已完成番茄鐘」的計數，並根據計數切換到短休息或長休息模式。
  - 休息時間結束後，會自動切換回番茄鐘模式。

### 2.2. 待辦事項列表 (To-Do List)

- **新增任務**：
  - 使用者可以在輸入框中輸入文字，並點擊「+」按鈕或按下 Enter 鍵來新增任務。
  - 支援透過麥克風進行語音輸入來新增任務。

- **任務管理**：
  - **標示完成**：點擊任務前的核取方塊（Checkbox）可以將任務標示為完成或未完成。
  - **刪除任務**：點擊垃圾桶圖示可以刪除任務。
  - **獨立計時**：每個任務都有自己獨立的倒數計時器。

- **任務與計時器連動**：
  - 點擊任務本身或任務旁的「播放/暫停」按鈕，可以啟動或暫停與該任務關聯的番茄鐘。
  - 啟動任務計時器會同步更新主畫面的計時器時間和狀態。
  - 同一時間只允許一個任務計時器處於活動狀態。
  - 切換不同的活動任務會暫停上一個任務，並從新任務上次暫停的時間點繼續。

### 2.3. 設定 (Settings)

- 使用者可以點擊設定圖示來開啟設定對話框。
- 可調整的項目：
  - 番茄鐘（Pomodoro）的時長（分鐘）。
  - 短休息（Short Break）的時長（分鐘）。
  - 長休息（Long Break）的時長（分鐘）。
  - 啟用或禁用計時結束時的提示音。

### 2.4. 外觀主題 (Theme)

- 提供「淺色 (Light)」、「深色 (Dark)」和「跟隨系統 (System)」三種外觀模式。
- 使用者可以透過待辦事項列表右上角的按鈕進行切換。

## 3. 資料與狀態管理

應用程式的狀態主要透過 `localStorage` 進行本地儲存，以確保使用者關閉或重新整理頁面後資料不遺失。

- **`pomodoro-settings`**：儲存計時器時長和聲音設定。
- **`pomodoro-tasks`**：儲存待辦事項列表，包含每個任務的 ID、文字內容、完成狀態和剩餘時間。
- **`completed-pomodoros`**：儲存已完成的番茄鐘總數。
- **`active-task-id`**：儲存當前正在計時的任務 ID。
- **`vite-ui-theme`**：儲存當前的外觀主題。

## 4. 元件結構

- **`PomodoroClient` (`pomodoro-client.tsx`)**：
  - 應用的核心容器元件，管理所有主要狀態和業務邏輯。
  - 包含主計時器 `useEffect` 邏輯。
  - 處理模式切換、計時器啟動/暫停/重置。
  - 渲染主計時器 UI 和 `TodoList` 元件。

- **`TodoList` (`todo-list.tsx`)**：
  - 負責顯示待辦事項列表和相關的 UI 元素（輸入框、按鈕等）。
  - 處理任務的新增、刪除、標示完成等使用者互動。
  - 包含語音輸入的邏輯。
  - 將使用者操作的事件向上傳遞給 `PomodoroClient` 處理。

- **`SettingsDialog` (`settings-dialog.tsx`)**：
  - 彈出式對話框，提供使用者修改計時器設定的介面。

- **`useLocalStorage` (`use-local-storage.ts`)**：
  - 一個自訂的 React Hook，用於將狀態與 `localStorage` 同步，並處理 SSR 中的 Hydration Mismatch 問題。

## 5. 技術規格

- **前端框架**：Next.js (App Router), React
- **UI 元件庫**：shadcn/ui
- **樣式**：Tailwind CSS
- **計時結束提示音**：Tone.js
- **語音辨識**：Web Speech API (`window.webkitSpeechRecognition`)
- **狀態管理**：React Hooks (`useState`, `useEffect`, `useCallback`) + `localStorage`
